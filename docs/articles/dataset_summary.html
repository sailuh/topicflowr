<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dataset Summary Statistics â€¢ topicflowr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Dataset Summary Statistics">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">topicflowr</a>
        <span class="label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased package">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dataset_summary.html">Dataset Summary</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sailuh/topicflowr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Dataset Summary Statistics</h1>
                        <h4 class="author">Carlos Paradis</h4>
            
            <h4 class="date">2018-03-24</h4>
      
      <small>Source: <a href="https://github.com/sailuh/topicflowr/blob/master/vignettes/dataset_summary.Rmd"><code>vignettes/dataset_summary.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(topicflowr)</code></pre></div>
<p>The following contains the preparation of the corpus used through all the LDA models.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#years &lt;- as.character(2008:2016)</span>
years &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="dv">2008</span>)
months &lt;-<span class="st"> </span>month.abb[<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>]</code></pre></div>
<div id="load-dfm-for-a-given-month" class="section level1">
<h1 class="hasAnchor">
<a href="#load-dfm-for-a-given-month" class="anchor"></a>Load DFM for a given month</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> </span>suppressPackageStartupMessages

rawCorpus &lt;-<span class="st"> </span><span class="cf">function</span>(year,month,folder){

  <span class="co">#Subset in the folder containing all e-mail replies, the months of interest (leverages the fact the Month name is part of the file name)</span>
  is.document.from.month &lt;-<span class="st"> </span><span class="kw">grepl</span>(month,folder<span class="op">$</span>doc_id)
  folder.month &lt;-<span class="st"> </span>folder[is.document.from.month,]

  <span class="co"># Every e-mail reply is a document</span>
  corpus &lt;-<span class="st"> </span><span class="kw">corpus</span>(<span class="dt">x=</span>folder.month)
  
  <span class="co">#2008_Feb_223.txt 2008_Feb_227.txt 2008_Feb_300.txt</span>
  <span class="co">#0                0                0</span>
  
  <span class="co"># Tokens </span>
  
    tokens &lt;-<span class="st"> </span><span class="kw">tokens</span>(corpus, <span class="dt">what =</span> <span class="st">"word"</span>, <span class="dt">remove_punct =</span> <span class="ot">TRUE</span>)
  <span class="co">#tokens &lt;- tokens_tolower(tokens)</span>
  
  <span class="co"># DFM</span>
  dfm &lt;-<span class="st"> </span><span class="kw">dfm</span>(tokens)
  
  <span class="kw">return</span>(dfm)
}

filterCorpus &lt;-<span class="st"> </span><span class="cf">function</span>(year,month,folder){

  <span class="co">#Subset in the folder containing all e-mail replies, the months of interest (leverages the fact the Month name is part of the file name)</span>
  is.document.from.month &lt;-<span class="st"> </span><span class="kw">grepl</span>(month,folder<span class="op">$</span>doc_id)
  folder.month &lt;-<span class="st"> </span>folder[is.document.from.month,]

  <span class="co"># Every e-mail reply is a document</span>
  corpus &lt;-<span class="st"> </span><span class="kw">corpus</span>(<span class="dt">x=</span>folder.month)

  <span class="co">#2008_Feb_223.txt 2008_Feb_227.txt 2008_Feb_300.txt</span>
  <span class="co">#0                0                0</span>


  <span class="co"># Tokenize. Several assumptions made here on pre-processing.</span>
  tokens &lt;-<span class="st"> </span><span class="kw">tokens</span>(corpus, <span class="dt">what =</span> <span class="st">"word"</span>, <span class="dt">remove_numbers =</span> <span class="ot">FALSE</span>, <span class="dt">remove_punct =</span> <span class="ot">TRUE</span>,
                   <span class="dt">remove_symbols =</span> <span class="ot">TRUE</span>, <span class="dt">remove_separators =</span> <span class="ot">TRUE</span>,
                   <span class="dt">remove_twitter =</span> <span class="ot">FALSE</span>, <span class="dt">remove_hyphens =</span> <span class="ot">FALSE</span>, <span class="dt">remove_url =</span> <span class="ot">TRUE</span>)
  tokens &lt;-<span class="st"> </span><span class="kw">tokens_tolower</span>(tokens)
  tokens &lt;-<span class="st"> </span><span class="kw">removeFeatures</span>(tokens, <span class="kw">stopwords</span>(<span class="st">"english"</span>))

  <span class="co"># Filter Empty Documents</span>
  tokens.length &lt;-<span class="st"> </span><span class="kw">sapply</span>(tokens,length)
  tokens &lt;-<span class="st"> </span>tokens[<span class="op">!</span>tokens.length <span class="op">==</span><span class="st"> </span><span class="dv">0</span>]

  <span class="co"># DFM</span>
  dfm &lt;-<span class="st"> </span><span class="kw">dfm</span>(tokens)

  <span class="co"># DFM filter for tokens with nchar &gt; 2 only</span>
  dfm &lt;-<span class="kw">dfm_select</span>(dfm,<span class="dt">min_nchar=</span><span class="dv">2</span>,<span class="dt">selection=</span><span class="st">"remove"</span>)  
  
  <span class="kw">return</span>(dfm)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">##### Monthly Corpus Statistics

get_dfm_statistics &lt;-<span class="st"> </span><span class="cf">function</span>(dfm){
  statistics &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>,<span class="dv">3</span>)
  <span class="kw">names</span>(statistics) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"n_documents"</span>,<span class="st">"vocabulary_size_mean"</span>,<span class="st">"vocabulary_size_sd"</span>)
  
  statistics[<span class="st">"n_documents"</span>] &lt;-<span class="st"> </span><span class="kw">nrow</span>(dfm)

  <span class="co"># Avg Vocabulary Size of Each Document </span>

  words_per_document &lt;-<span class="st"> </span><span class="kw">rowSums</span>(dfm)

  statistics[<span class="st">"vocabulary_size_mean"</span>] &lt;-<span class="st"> </span><span class="kw">mean</span>(words_per_document)

  <span class="co"># SD Vocabulary Size of Each Document </span>
  statistics[<span class="st">"vocabulary_size_sd"</span>] &lt;-<span class="st"> </span><span class="kw">sd</span>(words_per_document)  
  
  <span class="kw">return</span>(statistics)
}</code></pre></div>
</div>
<div id="analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#analysis" class="anchor"></a>Analysis</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfm_raw &lt;-<span class="st"> </span><span class="kw">rawCorpus</span>(<span class="dv">2016</span>,<span class="st">"Jan"</span>)
dfm_filter &lt;-<span class="st"> </span><span class="kw"><a href="../reference/filterCorpus.html">filterCorpus</a></span>(<span class="dv">2016</span>,<span class="st">"Jan"</span>)
<span class="kw">get_dfm_statistics</span>(dfm_raw)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_rows &lt;-<span class="st"> </span><span class="kw">length</span>(years)<span class="op">*</span><span class="kw">length</span>(months)

<span class="co"># Filter </span>
statistics_filter &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="kw">length</span>(years)<span class="op">*</span><span class="kw">length</span>(months),<span class="dv">4</span>))
<span class="kw">names</span>(statistics_filter) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"n_documents"</span>,<span class="st">"vocabulary_size_mean"</span>,<span class="st">"vocabulary_size_sd"</span>,<span class="st">"timestamp"</span>)

<span class="co"># No Filter</span>
statistics_no_filter &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="kw">length</span>(years)<span class="op">*</span><span class="kw">length</span>(months),<span class="dv">4</span>))
<span class="kw">names</span>(statistics_no_filter) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"n_documents"</span>,<span class="st">"vocabulary_size_mean"</span>,<span class="st">"vocabulary_size_sd"</span>,<span class="st">"timestamp"</span>)


<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(years)){
  
  fd.path &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"~/Desktop/PERCEIVE/full_disclosure_corpus/"</span>,years[i],<span class="st">".parsed"</span>)
  folder &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loadFiles.html">loadFiles</a></span>(<span class="dt">parsed.corpus.folder.path=</span>fd.path,<span class="dt">corpus_setup=</span><span class="st">"/**/*.reply.title_body.txt"</span>)
  
  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">"Year: "</span>,years[i]))
  
  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(months)){
    
    timestamp &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">ymd</span>(<span class="kw">str_c</span>(years[i],<span class="st">" "</span>,months[j],<span class="st">" "</span>,<span class="st">"1"</span>)))
    
    <span class="co"># With filter </span>
    statistic_filter &lt;-<span class="st"> </span><span class="kw">get_dfm_statistics</span>(<span class="kw"><a href="../reference/filterCorpus.html">filterCorpus</a></span>(years[i],months[j],folder))
    statistic_filter[<span class="st">'timestamp'</span>] &lt;-<span class="st"> </span>timestamp
    statistics_filter[(i<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="kw">length</span>(months) <span class="op">+</span><span class="st"> </span>j,] &lt;-<span class="st"> </span>statistic_filter
    
    <span class="co"># With no filter</span>
    
    statistic_no_filter &lt;-<span class="st"> </span><span class="kw">get_dfm_statistics</span>(<span class="kw">rawCorpus</span>(years[i],months[j],folder))
    statistic_no_filter[<span class="st">'timestamp'</span>] &lt;-<span class="st"> </span>timestamp
    statistics_no_filter[(i<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="kw">length</span>(months) <span class="op">+</span><span class="st"> </span>j,] &lt;-<span class="st"> </span>statistic_no_filter
    
   <span class="co"># print(paste0("Year: ",years[i]," month: ",months[j]))</span>
  }
}</code></pre></div>
<pre><code>## [1] "Year: 2008"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Filter</span>
statistics_filter &lt;-<span class="st"> </span><span class="kw">data.table</span>(statistics_filter)
statistics_filter<span class="op">$</span>n_documents &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(statistics_filter<span class="op">$</span>n_documents)
statistics_filter<span class="op">$</span>vocabulary_size_mean &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(statistics_filter<span class="op">$</span>vocabulary_size_mean)
statistics_filter<span class="op">$</span>vocabulary_size_sd &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(statistics_filter<span class="op">$</span>vocabulary_size_sd)
statistics_filter<span class="op">$</span>timestamp &lt;-<span class="st"> </span><span class="kw">ymd</span>(statistics_filter<span class="op">$</span>timestamp)

<span class="co">#No Filter</span>
statistics_no_filter &lt;-<span class="st"> </span><span class="kw">data.table</span>(statistics_no_filter)
statistics_no_filter<span class="op">$</span>n_documents &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(statistics_no_filter<span class="op">$</span>n_documents)
statistics_no_filter<span class="op">$</span>vocabulary_size_mean &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(statistics_no_filter<span class="op">$</span>vocabulary_size_mean)
statistics_no_filter<span class="op">$</span>vocabulary_size_sd &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(statistics_no_filter<span class="op">$</span>vocabulary_size_sd)
statistics_no_filter<span class="op">$</span>timestamp &lt;-<span class="st"> </span><span class="kw">ymd</span>(statistics_no_filter<span class="op">$</span>timestamp)



<span class="co">#plot_table$year &lt;- factor(year(plot_table$timestamp))</span>
<span class="co">#plot_table$month &lt;- factor(month(plot_table$timestamp))</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(statistics_filter, <span class="kw">aes</span>(timestamp, vocabulary_size_mean)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span><span class="st">"Yes"</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"Word Frequency Mean"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>statistics_filter,<span class="kw">aes</span>(<span class="dt">x=</span>timestamp,<span class="dt">y=</span>vocabulary_size_mean,<span class="dt">color=</span><span class="st">"Yes"</span>)) <span class="op">+</span><span class="st">   </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> statistics_no_filter, <span class="kw">aes</span>(<span class="dt">x =</span> timestamp, <span class="dt">y =</span> vocabulary_size_mean,<span class="dt">color =</span> <span class="st">"No"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>statistics_no_filter,<span class="kw">aes</span>(<span class="dt">x=</span>timestamp,<span class="dt">y=</span>vocabulary_size_mean,<span class="dt">color=</span><span class="st">"No"</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">color=</span><span class="st">"Filter"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"top"</span>) </code></pre></div>
<p><img src="dataset_summary_files/figure-html/Mean-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#+  geom_ribbon(aes(ymax = vocabulary_size_mean + vocabulary_size_sd, ymin = vocabulary_size_mean - vocabulary_size_sd), alpha = 0.5)</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spike_<span class="dv">2009</span> &lt;-<span class="st"> </span>statistics_no_filter[vocabulary_size_sd <span class="op">&gt;</span><span class="st"> </span><span class="dv">4000</span>]
spike_<span class="dv">2010</span> &lt;-<span class="st"> </span>statistics_no_filter[vocabulary_size_sd <span class="op">&gt;</span><span class="st"> </span><span class="dv">2000</span> <span class="op">&amp;</span><span class="st"> </span>vocabulary_size_sd <span class="op">&lt;</span><span class="st"> </span><span class="dv">4000</span>]

<span class="kw">ggplot</span>(statistics_filter, <span class="kw">aes</span>(timestamp, vocabulary_size_sd)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span><span class="st">"Yes"</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"Word Frequency Standard Deviation"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>statistics_filter,<span class="kw">aes</span>(<span class="dt">x=</span>timestamp,<span class="dt">y=</span>vocabulary_size_sd,<span class="dt">color=</span><span class="st">"Yes"</span>)) <span class="op">+</span><span class="st">   </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> statistics_no_filter, <span class="kw">aes</span>(<span class="dt">x =</span> timestamp, <span class="dt">y =</span> vocabulary_size_sd,<span class="dt">color =</span> <span class="st">"No"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>statistics_no_filter,<span class="kw">aes</span>(<span class="dt">x=</span>timestamp,<span class="dt">y=</span>vocabulary_size_sd,<span class="dt">color=</span><span class="st">"No"</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">color=</span><span class="st">"Filter"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"top"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(spike_<span class="dv">2009</span><span class="op">$</span>timestamp, spike_<span class="dv">2009</span><span class="op">$</span>vocabulary_size_sd <span class="op">-</span><span class="st"> </span><span class="dv">80</span>, <span class="dt">label =</span> <span class="st">"2009_Apr_186"</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="dv">1</span>), <span class="dt">colour =</span> <span class="st">'#000000'</span>, <span class="dt">size =</span> <span class="dv">3</span>,<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(spike_<span class="dv">2010</span><span class="op">$</span>timestamp, spike_<span class="dv">2010</span><span class="op">$</span>vocabulary_size_sd, <span class="dt">label =</span> <span class="st">"2010_Oct_364, 2010_Oct_368, 2010_Oct_372 "</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="dv">1</span>), <span class="dt">colour =</span> <span class="st">'#000000'</span>, <span class="dt">size =</span> <span class="dv">3</span>,<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) </code></pre></div>
<div id="exploring-the-two-sd-peaks" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-the-two-sd-peaks" class="anchor"></a>Exploring the two SD peaks</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fd.path &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"~/Desktop/PERCEIVE/full_disclosure_corpus/"</span>,<span class="dv">2009</span>,<span class="st">".parsed"</span>)
folder &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loadFiles.html">loadFiles</a></span>(<span class="dt">parsed.corpus.folder.path=</span>fd.path,<span class="dt">corpus_setup=</span><span class="st">"/**/*.reply.title_body.txt"</span>)
spike_<span class="dv">2009</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/filterCorpus.html">filterCorpus</a></span>(<span class="st">"2009"</span>,<span class="st">"Apr"</span>,folder)
spike_2009_words_per_document &lt;-<span class="st"> </span><span class="kw">rowSums</span>(spike_<span class="dv">2009</span>)
<span class="kw">barplot</span>(spike_2009_words_per_document)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spike_2009_words_per_document[spike_2009_words_per_document <span class="op">&gt;</span><span class="st"> </span><span class="dv">8000</span>]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fd.path &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"~/Desktop/PERCEIVE/full_disclosure_corpus/"</span>,<span class="dv">2010</span>,<span class="st">".parsed"</span>)
folder &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loadFiles.html">loadFiles</a></span>(<span class="dt">parsed.corpus.folder.path=</span>fd.path,<span class="dt">corpus_setup=</span><span class="st">"/**/*.reply.title_body.txt"</span>)
spike_<span class="dv">2010</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/filterCorpus.html">filterCorpus</a></span>(<span class="st">"2009"</span>,<span class="st">"Oct"</span>,folder)
spike_2010_words_per_document &lt;-<span class="st"> </span><span class="kw">rowSums</span>(spike_<span class="dv">2010</span>)
<span class="kw">barplot</span>(spike_2010_words_per_document)</code></pre></div>
<p>```</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spike_2010_words_per_document[spike_2010_words_per_document <span class="op">&gt;</span><span class="st"> </span><span class="dv">10000</span>]</code></pre></div>
</div>
</div>
<div id="n-docs" class="section level1">
<h1 class="hasAnchor">
<a href="#n-docs" class="anchor"></a>N Docs</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spike_docs_<span class="dv">2009</span> &lt;-<span class="st"> </span>statistics_no_filter[n_documents <span class="op">==</span><span class="st"> </span><span class="dv">979</span>]
spike_docs_<span class="dv">2011</span> &lt;-<span class="st"> </span>statistics_no_filter[n_documents <span class="op">==</span><span class="st"> </span><span class="dv">995</span>]


<span class="kw">ggplot</span>(statistics_filter, <span class="kw">aes</span>(timestamp, n_documents)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span><span class="st">"Yes"</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"Number of Documents"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>statistics_filter,<span class="kw">aes</span>(<span class="dt">x=</span>timestamp,<span class="dt">y=</span>n_documents,<span class="dt">color=</span><span class="st">"Yes"</span>)) <span class="op">+</span><span class="st">   </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> statistics_no_filter, <span class="kw">aes</span>(<span class="dt">x =</span> timestamp, <span class="dt">y =</span> n_documents,<span class="dt">color =</span> <span class="st">"No"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>statistics_no_filter,<span class="kw">aes</span>(<span class="dt">x=</span>timestamp,<span class="dt">y=</span>n_documents,<span class="dt">color=</span><span class="st">"No"</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">color=</span><span class="st">"Filter"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"top"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(spike_docs_<span class="dv">2009</span><span class="op">$</span>timestamp, spike_docs_<span class="dv">2009</span><span class="op">$</span>n_documents, <span class="dt">label =</span> <span class="st">"January 2009"</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="dv">1</span>), <span class="dt">colour =</span> <span class="st">'#000000'</span>, <span class="dt">size =</span> <span class="dv">3</span>,<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(spike_docs_<span class="dv">2011</span><span class="op">$</span>timestamp, spike_docs_<span class="dv">2011</span><span class="op">$</span>n_documents <span class="op">-</span><span class="st"> </span><span class="dv">10</span>, <span class="dt">label =</span> <span class="st">"October 2011"</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="dv">1</span>), <span class="dt">colour =</span> <span class="st">'#000000'</span>, <span class="dt">size =</span> <span class="dv">3</span>,<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) </code></pre></div>
</div>
<div id="validation-set-summary-statistics" class="section level1">
<h1 class="hasAnchor">
<a href="#validation-set-summary-statistics" class="anchor"></a>Validation Set Summary Statistics</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">validation_path &lt;-<span class="st"> "/Users/carlos/MEGA/Validation/FD Emails Labeled with CVE ID"</span>
file_names &lt;-<span class="st"> </span><span class="kw">list.files</span>(validation_path,<span class="dt">pattern=</span><span class="st">"*.csv"</span>)
validation_paths &lt;-<span class="st"> </span><span class="kw">file.path</span>(validation_path,file_names)
validation_files &lt;-<span class="st"> </span><span class="kw">lapply</span>(validation_paths,fread)
validation_file &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(validation_files)[,.(cve_id,file_id)]

<span class="co"># View(validation_file[month == "Dec" &amp; year == "2014"])</span>
<span class="co"># write.csv(validation_file[month == "Dec" &amp; year == "2014"],"~/Desktop/december_2014_spike.csv")</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">validation_file<span class="op">$</span>month &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">str_split</span>(validation_file<span class="op">$</span>file_id,<span class="st">"_"</span>),<span class="st">"[["</span>,<span class="dv">2</span>)
validation_file<span class="op">$</span>year &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">str_split</span>(validation_file<span class="op">$</span>file_id,<span class="st">"_"</span>),<span class="st">"[["</span>,<span class="dv">1</span>)
validation_frequency &lt;-<span class="st"> </span>validation_file[,.(<span class="dt">frequency=</span>.N),by=<span class="kw">c</span>(<span class="st">"month"</span>,<span class="st">"year"</span>)]

validation_frequency<span class="op">$</span>timestamp &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="kw">str_c</span>(validation_frequency<span class="op">$</span>year,<span class="st">" "</span>,validation_frequency<span class="op">$</span>month,<span class="st">" "</span>,<span class="st">"1"</span>))</code></pre></div>
</div>
<div id="number-of-documents-with-cve-id-per-corpus-" class="section level1">
<h1 class="hasAnchor">
<a href="#number-of-documents-with-cve-id-per-corpus-" class="anchor"></a>Number of Documents with CVE-ID per corpus.</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spike_<span class="dv">2014</span> &lt;-<span class="st"> </span>validation_frequency[frequency <span class="op">&gt;</span><span class="st"> </span><span class="dv">150</span>]
<span class="kw">ggplot</span>(validation_frequency, <span class="kw">aes</span>(timestamp, frequency)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"Number of Documents with CVE-ID"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>validation_frequency,<span class="kw">aes</span>(<span class="dt">x=</span>timestamp,<span class="dt">y=</span>frequency)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(spike_<span class="dv">2014</span><span class="op">$</span>timestamp, spike_<span class="dv">2014</span><span class="op">$</span>frequency, <span class="dt">label =</span> <span class="st">"December 2014"</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="dv">1</span>), <span class="dt">colour =</span> <span class="st">'#000000'</span>, <span class="dt">size =</span> <span class="dv">3</span>,<span class="dt">show.legend =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
<div id="number-of-documents-per-cve-id-per-month" class="section level1">
<h1 class="hasAnchor">
<a href="#number-of-documents-per-cve-id-per-month" class="anchor"></a>Number of documents per cve ID per month</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">validation_frequency_per_cveid &lt;-<span class="st"> </span>validation_file[,.(<span class="dt">frequency=</span>.N),by=<span class="kw">c</span>(<span class="st">"cve_id"</span>,<span class="st">"month"</span>,<span class="st">"year"</span>)]

<span class="co">#validation_frequency_per_cveid$timestamp &lt;- ymd(str_c(validation_frequency_per_cveid$year," ",validation_frequency_per_cveid$month," ","1"))</span>

f2 &lt;-<span class="st"> </span>validation_frequency_per_cveid[frequency<span class="op">==</span><span class="dv">2</span>,.(<span class="dt">frequency_2=</span>.N),by=<span class="kw">c</span>(<span class="st">"month"</span>,<span class="st">"year"</span>)]
f3 &lt;-<span class="st"> </span>validation_frequency_per_cveid[frequency<span class="op">==</span><span class="dv">3</span>,.(<span class="dt">frequency_3=</span>.N),by=<span class="kw">c</span>(<span class="st">"month"</span>,<span class="st">"year"</span>)]
f4 &lt;-<span class="st"> </span>validation_frequency_per_cveid[frequency<span class="op">==</span><span class="dv">4</span>,.(<span class="dt">frequency_4=</span>.N),by=<span class="kw">c</span>(<span class="st">"month"</span>,<span class="st">"year"</span>)]
f5 &lt;-<span class="st"> </span>validation_frequency_per_cveid[frequency<span class="op">==</span><span class="dv">5</span>,.(<span class="dt">frequency_5=</span>.N),by=<span class="kw">c</span>(<span class="st">"month"</span>,<span class="st">"year"</span>)]

f2<span class="op">$</span>timestamp &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="kw">str_c</span>(f2<span class="op">$</span>year,<span class="st">" "</span>,f2<span class="op">$</span>month,<span class="st">" "</span>,<span class="st">"1"</span>))
f3<span class="op">$</span>timestamp &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="kw">str_c</span>(f3<span class="op">$</span>year,<span class="st">" "</span>,f3<span class="op">$</span>month,<span class="st">" "</span>,<span class="st">"1"</span>))
f4<span class="op">$</span>timestamp &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="kw">str_c</span>(f4<span class="op">$</span>year,<span class="st">" "</span>,f4<span class="op">$</span>month,<span class="st">" "</span>,<span class="st">"1"</span>))
f5<span class="op">$</span>timestamp &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="kw">str_c</span>(f5<span class="op">$</span>year,<span class="st">" "</span>,f5<span class="op">$</span>month,<span class="st">" "</span>,<span class="st">"1"</span>))

f2 &lt;-<span class="st"> </span>f2[<span class="kw">order</span>(timestamp)]
f3 &lt;-<span class="st"> </span>f3[<span class="kw">order</span>(timestamp)]
f4 &lt;-<span class="st"> </span>f4[<span class="kw">order</span>(timestamp)]
f5 &lt;-<span class="st"> </span>f5[<span class="kw">order</span>(timestamp)]

f2<span class="op">$</span>cumsum &lt;-<span class="st"> </span><span class="kw">cumsum</span>(f2[[<span class="st">"frequency_2"</span>]])
f3<span class="op">$</span>cumsum &lt;-<span class="st"> </span><span class="kw">cumsum</span>(f3[[<span class="st">"frequency_3"</span>]])
f4<span class="op">$</span>cumsum &lt;-<span class="st"> </span><span class="kw">cumsum</span>(f4[[<span class="st">"frequency_4"</span>]])
f5<span class="op">$</span>cumsum &lt;-<span class="st"> </span><span class="kw">cumsum</span>(f5[[<span class="st">"frequency_5"</span>]])



<span class="kw">ggplot</span>(f2, <span class="kw">aes</span>(timestamp, cumsum,<span class="dt">color=</span><span class="st">"2"</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"Cumulative Frequency of documents with the same CVE-IDs"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="kw">geom_line</span>(<span class="dt">data =</span> f3, <span class="kw">aes</span>(<span class="dt">x =</span> timestamp, <span class="dt">y =</span> cumsum,<span class="dt">color =</span> <span class="st">"3"</span>)) <span class="op">+</span><span class="st"> </span>
<span class="kw">geom_line</span>(<span class="dt">data =</span> f4, <span class="kw">aes</span>(<span class="dt">x =</span> timestamp, <span class="dt">y =</span> cumsum,<span class="dt">color =</span> <span class="st">"4"</span>)) <span class="op">+</span><span class="st"> </span>
<span class="kw">geom_point</span>(<span class="dt">data =</span> f5, <span class="kw">aes</span>(<span class="dt">x =</span> timestamp, <span class="dt">y =</span> cumsum,<span class="dt">color =</span> <span class="st">"5"</span>)) <span class="op">+</span><span class="st"> </span>
<span class="kw">geom_point</span>(<span class="dt">data=</span>f2,<span class="kw">aes</span>(<span class="dt">x=</span>timestamp,<span class="dt">y=</span>cumsum,<span class="dt">color=</span><span class="st">"2"</span>)) <span class="op">+</span><span class="st"> </span>
<span class="kw">geom_point</span>(<span class="dt">data=</span>f3,<span class="kw">aes</span>(<span class="dt">x=</span>timestamp,<span class="dt">y=</span>cumsum,<span class="dt">color=</span><span class="st">"3"</span>)) <span class="op">+</span><span class="st"> </span>
<span class="kw">geom_point</span>(<span class="dt">data=</span>f4,<span class="kw">aes</span>(<span class="dt">x=</span>timestamp,<span class="dt">y=</span>cumsum,<span class="dt">color=</span><span class="st">"4"</span>)) <span class="op">+</span>
<span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="kw">ymd</span>(<span class="st">"2017-01-01"</span>), <span class="dv">64</span>, <span class="dt">label =</span> <span class="st">"64"</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="dv">1</span>), <span class="dt">color =</span> <span class="st">"#F8766D"</span>, <span class="dt">size =</span> <span class="dv">3</span>,<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>
<span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="kw">ymd</span>(<span class="st">"2016-10-01"</span>), <span class="dv">11</span>, <span class="dt">label =</span> <span class="st">"11"</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="dv">1</span>), <span class="dt">color =</span> <span class="st">"#7CAE00"</span>, <span class="dt">size =</span> <span class="dv">3</span>,<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>
<span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="kw">ymd</span>(<span class="st">"2015-09-01"</span>), <span class="dv">3</span>, <span class="dt">label =</span> <span class="st">"3"</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="dv">1</span>), <span class="dt">color =</span> <span class="st">"#00BFC4"</span>, <span class="dt">size =</span> <span class="dv">3</span>,<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>
<span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="kw">ymd</span>(<span class="st">"2014-04-01"</span>), <span class="dv">1</span>, <span class="dt">label =</span> <span class="st">"1"</span>, <span class="dt">vjust =</span> <span class="op">-</span><span class="dv">1</span>), <span class="dt">color =</span> <span class="st">"#C77CFF"</span>, <span class="dt">size =</span> <span class="dv">3</span>,<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>
<span class="kw">labs</span>(<span class="dt">color=</span><span class="st">"Number of Documents"</span>) <span class="op">+</span><span class="st"> </span>
<span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"top"</span>)
<span class="co">#  geom_point(data=validation_frequency_per_cveid,aes(x=timestamp,y=frequency))</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-dfm-for-a-given-month">Load DFM for a given month</a></li>
      <li>
<a href="#analysis">Analysis</a><ul class="nav nav-pills nav-stacked">
<li><a href="#exploring-the-two-sd-peaks">Exploring the two SD peaks</a></li>
      </ul>
</li>
      <li><a href="#n-docs">N Docs</a></li>
      <li><a href="#validation-set-summary-statistics">Validation Set Summary Statistics</a></li>
      <li><a href="#number-of-documents-with-cve-id-per-corpus-">Number of Documents with CVE-ID per corpus.</a></li>
      <li><a href="#number-of-documents-per-cve-id-per-month">Number of documents per cve ID per month</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Carlos Paradis, Rick Kazman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
